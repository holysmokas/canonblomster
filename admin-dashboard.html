<!DOCTYPE html>
<html lang="da">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Dashboard | Canon Blomster</title>
    <link rel="stylesheet" href="styles/admin-dashboard.css" />
    <link rel="stylesheet" href="styles/main.css" />
</head>

<body>
    <!-- HEADER -->
    <header class="header-flex">
        <h1>CANON BLOMSTER</h1>
        <p class="opening-hours">
            Ã…bent: M â€” F 10:00â€”17:00 | LÃ¸r. og SÃ¸n. 10:00â€”16:00
        </p>
        <button id="logoutBtn" class="logout-btn">Log ud</button>
    </header>

    <!-- MAIN -->
    <main class="dashboard-container">
        <section class="form-card">
            <h2>ðŸŒ¼ TilfÃ¸j nyt produkt</h2>

            <form id="addProductForm">
                <label for="productName">Produktnavn</label>
                <input type="text" id="productName" name="productName" placeholder="F.eks. Roser i buket" required />

                <label for="productPrice">Pris (kr)</label>
                <input type="number" id="productPrice" name="productPrice" placeholder="F.eks. 150" required />

                <label for="productDescription">Beskrivelse</label>
                <textarea id="productDescription" name="productDescription"
                    placeholder="Kort beskrivelse af produktet"></textarea>

                <label for="productImage">Upload billede</label>
                <input type="file" id="productImage" name="productImage" accept="image/*" />

                <button type="submit" class="submit-btn">+ TilfÃ¸j produkt</button>
            </form>

            <p id="statusMessage"></p>
            <button id="addAnotherBtn" class="secondary-btn" style="display:none;">+ TilfÃ¸j endnu et produkt</button>
        </section>
    </main>

    <footer class="site-footer">
        <p>Â© 2025 Canon Blomster | <a href="index.html">Tilbage til forside</a></p>
    </footer>

    <script>
        // ðŸ”— Replace this with your new Apps Script Web App URL
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwvg7z5VuM33BnXJD1Wu76FNFpX20E5P-t68gpbgYdOZHzMvQkdh4mbFlkBpjjrd2m4/exec";

        const form = document.getElementById('addProductForm');
        const addAnotherBtn = document.getElementById('addAnotherBtn');
        const statusMessage = document.getElementById('statusMessage');
        const logoutBtn = document.getElementById('logoutBtn');

        form.addEventListener('submit', async (e) => {
            e.preventDefault();

            const name = document.getElementById('productName').value.trim();
            const price = document.getElementById('productPrice').value.trim();
            const description = document.getElementById('productDescription').value.trim();
            const imageInput = document.getElementById('productImage');

            let imageBase64 = "";
            let imageName = "";
            let imageType = "";

            if (imageInput.files.length > 0) {
                const file = imageInput.files[0];
                imageName = file.name;
                imageType = file.type;
                const reader = new FileReader();
                await new Promise(resolve => {
                    reader.onload = () => {
                        imageBase64 = reader.result.split(",")[1];
                        resolve();
                    };
                    reader.readAsDataURL(file);
                });
            }

            const product = { name, price, description, imageBase64, imageName, imageType };

            statusMessage.textContent = "â³ Uploading produkt...";
            statusMessage.style.color = "#555";

            try {
                const res = await fetch(SCRIPT_URL, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(product)
                });

                const result = await res.json();

                if (result.result === "success") {
                    statusMessage.textContent = "âœ… Produkt tilfÃ¸jet!";
                    statusMessage.style.color = "green";
                    form.reset();
                    form.style.display = "none";
                    addAnotherBtn.style.display = "inline-block";
                } else {
                    throw new Error(result.message || "Ukendt fejl");
                }
            } catch (err) {
                console.error(err);
                statusMessage.textContent = "âŒ Fejl: " + err.message;
                statusMessage.style.color = "red";
            }
        });

        addAnotherBtn.addEventListener('click', () => {
            form.style.display = "block";
            addAnotherBtn.style.display = "none";
            statusMessage.textContent = "";
        });

        logoutBtn.addEventListener('click', () => {
            window.location.href = "admin-login.html";
        });
    </script>
</body>

</html>